<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Feedback Form</title>
</head>
<body>

<!-- HTML form for user feedback -->
<form id="feedbackForm">
    <label for="feedback">Enter your feedback:</label>
    <input type="text" id="feedback" name="feedback" required>
    <button type="button" onclick="loginWithDiscord()">Login with Discord</button>
    <button type="button" onclick="sendFeedback()">Submit Feedback</button>
</form>

<script>
    let accessToken; // Store the user's Discord access token
    let userUsername; // Store the user's Discord username

    // Function to open Discord OAuth login window
    function loginWithDiscord() {
        // Replace 'YOUR_DISCORD_CLIENT_ID' with your Discord application's client ID
        const clientId = '1186683131974135919';

        // Replace 'YOUR_REDIRECT_URI' with the actual redirect URI for your application
        const redirectUri = encodeURIComponent(window.location.href);

        // Redirect the user to Discord OAuth login
        window.location.href = `https://discord.com/api/oauth2/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=token&scope=identify`;
    }

    // Function to handle the callback after Discord OAuth login
    function handleDiscordLogin() {
        // Get the access token from the URL fragment
        const urlParams = new URLSearchParams(window.location.hash.substr(1));
        accessToken = urlParams.get('access_token');

        // Fetch the user's Discord username
        fetch('https://discord.com/api/users/@me', {
            headers: {
                'Authorization': `Bearer ${accessToken}`,
            },
        })
        .then(response => response.json())
        .then(data => {
            userUsername = data.username;
        })
        .catch(error => {
            console.error('Error fetching Discord user data:', error);
        });
    }

    // Function to send feedback to Discord along with user information
    function sendFeedback() {
        if (!accessToken) {
            alert('Please login with Discord first.');
            return;
        }

        // Replace 'YOUR_DISCORD_WEBHOOK_URL' with your actual Discord webhook URL
        const webhookUrl = 'https://discordapp.com/api/webhooks/1190666512982351983/Kom4kaWH_jQe2nUC6UbdSgxYJX8uorotKgk4pWE4wH8I1Kgo2ozW4wQr38cB86g5yoXv';

        // Get the feedback from the input field
        const feedback = document.getElementById('feedback').value;

        // Prepare the data to be sent to the Discord webhook
        const data = {
            content: feedback,
            username: userUsername || 'Anonymous', // Use the obtained Discord username or default to 'Anonymous'
        };

        // Use fetch to send a POST request to the Discord webhook
        fetch(webhookUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
        .then(response => {
            if (!response.ok) {
                console.error('Error sending feedback to Discord:', response.status, response.statusText);
            } else {
                console.log('Feedback sent successfully to Discord!');
            }
        })
        .catch(error => {
            console.error('Error sending feedback to Discord:', error);
        });
    }

    // Check if the page has the access token in the URL fragment
    document.addEventListener('DOMContentLoaded', handleDiscordLogin);
</script>

</body>
</html>
